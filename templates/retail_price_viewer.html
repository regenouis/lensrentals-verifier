<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lensrentals Product Verifier</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body { padding: 2rem; background: #f9f9f9; }
    .container { background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .title-icon { font-size: 1.5rem; margin-right: 0.5rem; }
    .price-summary a { font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h3><span class="title-icon">üîç</span>Lensrentals Product Verifier</h3>

    <div class="form-row my-3">
      <div class="col-md-6 mb-2">
        <input id="name" class="form-control" type="text" placeholder="e.g., Sony FX3" autocomplete="off">
      </div>
      <div class="col-md-6 mb-2">
        <input id="mpn" class="form-control" type="text" placeholder="e.g., ILME-FX3A" autocomplete="off">
      </div>
    </div>
    <small class="text-muted mb-3 d-block">Enter a product name or MPN ‚Äî one is required.</small>

    <div class="mb-3">
      <button id="checkBtn" class="btn btn-primary">Check Prices</button>
      <button id="resetBtn" class="btn btn-secondary">Reset</button>
    </div>

    <div id="error" class="text-danger mb-2"></div>

    <h5>üìé Pricing Summary</h5>
    <div id="results" class="price-summary">
      <p><strong>B&H Photo:</strong> <span id="bhResult">‚Äî</span></p>
      <p><strong>Adorama:</strong> <span id="adoramaResult">‚Äî</span></p>
      <p><strong>eBay Sold:</strong> <span id="ebayResult">‚Äî</span></p>
      <p><strong>MPB:</strong> <span id="mpbResult">‚Äî</span></p>
    </div>
  </div>

  <script>
    document.getElementById('checkBtn').addEventListener('click', async () => {
      const name = document.getElementById('name').value.trim();
      const mpn = document.getElementById('mpn').value.trim();
      const errorEl = document.getElementById('error');
      errorEl.textContent = '';

      if (!name && !mpn) {
        errorEl.textContent = 'Please enter a product name or MPN.';
        return;
      }

      const res = await fetch('/check', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, mpn })
      });

      const data = await res.json();

      document.getElementById('bhResult').innerHTML =
        data.bh?.status === 'In Stock'
        ? `<a href="${data.bh.url}" target="_blank">${data.bh.status} ‚Äî ${data.bh.price}${data.bh.used_price ? ' (Used: ' + data.bh.used_price + ')' : ''}</a>`
        : data.bh?.status || '‚Äî';

      document.getElementById('adoramaResult').innerHTML =
        data.adorama?.status || '‚Äî';

      document.getElementById('ebayResult').innerHTML =
        data.ebay?.price
        ? `<a href="${data.ebay.url}" target="_blank">${data.ebay.price}</a>`
        : '‚Äî';

      document.getElementById('mpbResult').innerHTML =
        data.mpb?.price
        ? `<a href="${data.mpb.url}" target="_blank">${data.mpb.status} ‚Äî ${data.mpb.price}</a>`
        : '‚Äî';
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      document.getElementById('name').value = '';
      document.getElementById('mpn').value = '';
      document.getElementById('error').textContent = '';
      document.getElementById('bhResult').textContent = '‚Äî';
      document.getElementById('adoramaResult').textContent = '‚Äî';
      document.getElementById('ebayResult').textContent = '‚Äî';
      document.getElementById('mpbResult').textContent = '‚Äî';
    });

    // Clear old autofilled input values on refresh
    window.addEventListener('pageshow', () => {
      document.getElementById('name').value = '';
      document.getElementById('mpn').value = '';
    });
  </script>
</body>
</html>
